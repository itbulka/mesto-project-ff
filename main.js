(()=>{"use strict";var t=document.querySelector("#card-template").content,e=function(e,n,o,r,c){var a=e.name,i=e.link,u=e.likes,l=e.owner,s=e._id,d=t.querySelector(".card").cloneNode(!0);return d.querySelector(".card__image").src=i,d.querySelector(".card__image").alt="На фотке ".concat(a),d.querySelector(".card__title").textContent=a,n._id===l._id?d.querySelector(".card__delete-button").addEventListener("click",(function(){return o(d,s)})):d.querySelector(".card__delete-button").hidden=!0,u.some((function(t){return t._id===n._id}))&&d.querySelector(".card__like-button").classList.add("card__like-button_is-active"),d.querySelector(".card__like-button").addEventListener("click",(function(t){return r(t,d,s)})),d.querySelector(".card__like-counter").textContent=u.length,d.querySelector(".card__image").addEventListener("click",(function(){return c(a,i)})),d};function n(t){t.classList.contains("popup_is-opened")&&(t.classList.remove("popup_is-opened"),document.removeEventListener("keydown",r))}var o=function(t){t.target.classList.contains("popup")&&n(t.currentTarget)},r=function(t){console.log("Enter function closePopupEscape"),"Escape"===t.key&&n(document.querySelector(".popup_is-opened"))};function c(t){t.classList.contains("popup_is-opened")||(t.classList.add("popup_is-opened"),t.addEventListener("click",o),document.addEventListener("keydown",r))}var a=function(t,e,n){var o=t.querySelector(".".concat(e.name,"-error")),r=e.validationMessage;e.classList.remove(n.inputErrorClass),o.classList.remove(n.inputErrorActiveClass),o.textContent=r},i=function(t,e,n){!function(t){return t.some((function(t){return!t.validity.valid}))}(e)?(t.disabled=!1,t.classList.remove(n.buttonSubmitDisableClass)):(t.disabled=!0,t.classList.add(n.buttonSubmitDisableClass))},u=function(t,e){var n=Array.from(t.querySelectorAll(e.inputSelector)),o=t.querySelector(e.buttonSubmitSelector);o.disabled=!0,o.classList.add(e.buttonSubmitDisableClass),n.forEach((function(n){a(t,n,e)}))},l="https://mesto.nomoreparties.co/v1/",s="6223133f-511d-41ca-ae06-fcd11b2453ad",d="cohort-magistr-2",p=function(t){return t.ok?t.json():Promise.reject("Status ".concat(t.status))},f=function(t){return fetch("".concat(l).concat(d,"/cards/likes/").concat(t),{method:"PUT",headers:{authorization:s}}).then(p)},m=function(t){return fetch("".concat(l).concat(d,"/cards/likes/").concat(t),{method:"DELETE",headers:{authorization:s}}).then(p)};function _(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,o=new Array(e);n<e;n++)o[n]=t[n];return o}var v,y=document.querySelector(".places__list"),b=document.querySelector(".profile__title"),h=document.querySelector(".profile__description"),S=document.querySelector(".profile__image"),g=document.querySelector(".profile__edit-button"),C=document.querySelector(".profile__add-button"),E=document.querySelector(".popup_type_edit"),q=document.forms["edit-profile"],L=q.elements.name,k=q.elements.description,x=document.querySelector(".popup_type_new-card"),A=document.forms["new-place"],T=A.elements["place-name"],j=A.elements.link,w=document.querySelector(".popup_type_image"),D=w.querySelector(".popup__caption"),z=w.querySelector(".popup__image"),O=document.querySelector(".popup_type_edit-avatar"),P=document.forms["edit-avatar"],I=P.elements.link,M={inputSelector:".popup__input",inputErrorClass:"popup__input_type_error",inputErrorActiveClass:"popup__input_error-active",buttonSubmitSelector:".popup__button",buttonSubmitDisableClass:"popup__button_inactive"};S.addEventListener("click",(function(){return u(P,M),I.value="",void c(O)})),g.addEventListener("click",(function(){return u(q,M),L.value=b.textContent,k.value=h.textContent,void c(E)})),E.querySelector(".popup__close").addEventListener("click",(function(t){return n(E)})),C.addEventListener("click",(function(t){u(A,M),c(x)})),x.querySelector(".popup__close").addEventListener("click",(function(t){return n(x)})),w.querySelector(".popup__close").addEventListener("click",(function(t){return n(w)})),O.querySelector(".popup__close").addEventListener("click",(function(){return n(O)})),v={formSelector:".popup__form",inputSelector:".popup__input",buttonSubmitSelector:".popup__button",inputErrorClass:"popup__input_type_error",inputErrorActiveClass:"popup__input_error-active",buttonSubmitDisableClass:"popup__button_inactive"},Array.from(document.querySelectorAll(v.formSelector)).forEach((function(t){!function(t,e){var n=Array.from(t.querySelectorAll(e.inputSelector)),o=t.querySelector(e.buttonSubmitSelector);i(o,n,e),n.forEach((function(r){r.addEventListener("input",(function(){!function(t,e,n){e.validity.valid?a(t,e,n):(e.validity.patternMismatch?e.setCustomValidity(e.dataset.errorMessage):e.setCustomValidity(""),function(t,e,n){var o=t.querySelector(".".concat(e.name,"-error")),r=e.validationMessage;e.classList.add(n.inputErrorClass),o.classList.add(n.inputErrorActiveClass),o.textContent=r}(t,e,n))}(t,r,e),i(o,n,e)}))}))}(t,v)}));var N=function(t,e){D.textContent=t,z.src=e,z.alt="На фото ".concat(t),c(w)},J=function(t,e){var n;(n=e,fetch("".concat(l).concat(d,"/cards/").concat(n),{method:"DELETE",headers:{authorization:s}}).then(p)).then((function(e){t.remove()})).catch((function(t){return console.log(t)}))},H=function(t,e,n){(t.target.classList.contains("card__like-button")&&t.target.classList.contains("card__like-button_is-active")?m:f)(n).then((function(n){e.querySelector(".card__like-counter").textContent=n.likes.length,t.target.classList.toggle("card__like-button_is-active")})).catch((function(t){return console.log(t)}))};Promise.all([fetch("".concat(l).concat(d,"/users/me"),{headers:{authorization:s}}).then(p),fetch("".concat(l).concat(d,"/cards"),{headers:{authorization:s}}).then(p)]).then((function(t){var n,o,r,c,a,i=(a=2,function(t){if(Array.isArray(t))return t}(c=t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var o,r,c,a,i=[],u=!0,l=!1;try{if(c=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;u=!1}else for(;!(u=(o=c.call(n)).done)&&(i.push(o.value),i.length!==e);u=!0);}catch(t){l=!0,r=t}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(l)throw r}}return i}}(c,a)||function(t,e){if(t){if("string"==typeof t)return _(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_(t,e):void 0}}(c,a)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),u=i[0],l=i[1];n=u.name,o=u.about,r=u.avatar,b.textContent=n,h.textContent=o,S.style.backgroundImage="url('".concat(r,"')"),function(t,n,o){n.forEach((function(n){t.append(e(n,o,J,H,N))}))}(y,l,u)})).catch((function(t){return console.log(t)})),q.addEventListener("submit",(function(t){var e,o;t.preventDefault(),t.submitter.textContent="Сохранение...",(e=L.value,o=k.value,fetch("".concat(l).concat(d,"/users/me"),{method:"PATCH",headers:{authorization:s,"Content-Type":"application/json"},body:JSON.stringify({name:e,about:o})}).then(p)).then((function(t){b.textContent=t.name,h.textContent=t.about})).catch((function(t){return console.log(t)})).finally((function(){L.value="",k.value="",t.submitter.textContent="Сохранить",n(E)}))})),A.addEventListener("submit",(function(t){var o,r;t.preventDefault(),t.submitter.textContent="Сохранение...",(o=T.value,r=j.value,fetch("".concat(l).concat(d,"/cards"),{method:"POST",headers:{authorization:s,"Content-Type":"application/json"},body:JSON.stringify({name:o,link:r})}).then(p)).then((function(t){var n=t.owner,o=e(t,n,J,H,N);y.prepend(o)})).catch((function(t){return console.log(t)})).finally((function(){T.value="",j.value="",t.submitter.textContent="Сохранить",n(x)}))})),P.addEventListener("submit",(function(t){t.preventDefault(),t.submitter.textContent="Сохранение...";var e,o=I.value;(e=o,fetch("".concat(l).concat(d,"/users/me/avatar"),{method:"PATCH",headers:{authorization:s,"Content-Type":"application/json"},body:JSON.stringify({avatar:e})}).then(p)).then((function(t){S.style.backgroundImage="url('".concat(o,"')")})).catch((function(t){return console.log(t)})).finally((function(){I.value="",t.submitter.textContent="Сохранить",n(O)}))}))})();